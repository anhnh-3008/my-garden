<!DOCTYPE html>
<html><head><title>🌱 ELB - Elastic Load Balancing</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="🌱 ELB - Elastic Load Balancing"/><meta property="og:description" content="🌿 What? § Là dịch vụ phân phối tải tới các instances của hệ thống. 🌿 Why to use? § Phân phối tải đều cho những instances của hệ thống, tránh tình trạng quá tải."/><meta property="og:image" content="https://https://anhhn.netlify.app//static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../../static/icon.png"/><meta name="description" content="🌿 What? § Là dịch vụ phân phối tải tới các instances của hệ thống. 🌿 Why to use? § Phân phối tải đều cho những instances của hệ thống, tránh tình trạng quá tải."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Dancing Script:wght@400;700&amp;family=Signika Negative:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch(`../../../static/contentIndex.json`).then(data => data.json())</script></head><body data-slug="40123345-posts/42-Code/42.03-AWS/ELB---Elastic-Load-Balancing"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="../../..">🪴 HA's Garden</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabIndex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabIndex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xmlSpace="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xmlSpace="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="toc desktop-only"><button type="button" id="toc"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#-what" data-for="-what">🌿 What?</a></li><li class="depth-0"><a href="#-why-to-use" data-for="-why-to-use">🌿 Why to use?</a></li><li class="depth-0"><a href="#-types-of-load-balancer-on-aws" data-for="-types-of-load-balancer-on-aws">🌿 Types of load balancer on AWS</a></li><li class="depth-1"><a href="#-classic-load-balancer" data-for="-classic-load-balancer">🍃 Classic Load Balancer</a></li><li class="depth-1"><a href="#-application-load-balancer" data-for="-application-load-balancer">🍃 Application Load Balancer</a></li><li class="depth-1"><a href="#-network-load-balancer" data-for="-network-load-balancer">🍃 Network Load Balancer</a></li><li class="depth-1"><a href="#-gateway-load-balancer" data-for="-gateway-load-balancer">🍃 Gateway Load Balancer</a></li><li class="depth-0"><a href="#-security-group" data-for="-security-group">🌿 Security Group</a></li><li class="depth-0"><a href="#-sticky-sessionsession-affinity" data-for="-sticky-sessionsession-affinity">🌿 Sticky Session(Session Affinity)</a></li><li class="depth-0"><a href="#-cross-zone-load-balancing" data-for="-cross-zone-load-balancing">🌿 Cross-Zone Load Balancing</a></li><li class="depth-0"><a href="#-ssl-certificates" data-for="-ssl-certificates">🌿 SSL Certificates</a></li><li class="depth-1"><a href="#-server-name-indication" data-for="-server-name-indication">🍃 Server Name Indication</a></li><li class="depth-0"><a href="#-connection-draining" data-for="-connection-draining">🌿 Connection Draining</a></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><h1 class="article-title">🌱 ELB - Elastic Load Balancing</h1><p class="content-meta">Mar 05, 2023, 5 min read</p><ul class="tags"><li><a href="../../../tags/aws" class="internal tag-link">#aws</a></li></ul></div></div><article class="popover-hint"><h2 id="-what">🌿 What?<a aria-hidden="true" tabindex="-1" href="#-what" class="internal"> §</a></h2>
<p><img src="../../../00-Meta/01-Attachments/Pasted-image-20230305184858.png" width="auto" height="auto"/></p>
<ul>
<li>Là dịch vụ phân phối tải tới các instances của hệ thống.</li>
</ul>
<h2 id="-why-to-use">🌿 Why to use?<a aria-hidden="true" tabindex="-1" href="#-why-to-use" class="internal"> §</a></h2>
<ul>
<li>Phân phối tải đều cho những instances của hệ thống, tránh tình trạng quá tải.</li>
<li>Expose một điểm truy cập(DNS) duy nhất cho ứng dụng</li>
<li>Vẫn hoạt động bình thường khi có lỗi ở một instance.</li>
<li>Cung cấp SSL cho web</li>
<li>Tách biệt được public traffic và private traffic.</li>
<li>Thực hiện heath check thường xuyên cho các instances.</li>
</ul>
<h2 id="-types-of-load-balancer-on-aws">🌿 Types of load balancer on AWS<a aria-hidden="true" tabindex="-1" href="#-types-of-load-balancer-on-aws" class="internal"> §</a></h2>
<ul>
<li>Nên dùng mấy cái gen mới, nó sẽ cung cấp nhiều tính năng mới hơn.</li>
<li>Một số load balancers có thể setup private hoặc public ELBs.</li>
</ul>
<h3 id="-classic-load-balancer">🍃 Classic Load Balancer<a aria-hidden="true" tabindex="-1" href="#-classic-load-balancer" class="internal"> §</a></h3>
<ul>
<li>v1 - 2009 - CLB (có warning deprecated nhưng vẫn available)</li>
<li>HTTP, HTTPS, TCP, SSL</li>
</ul>
<h3 id="-application-load-balancer">🍃 Application Load Balancer<a aria-hidden="true" tabindex="-1" href="#-application-load-balancer" class="internal"> §</a></h3>
<ul>
<li>
<p>v2 - 2016 - ALB</p>
</li>
<li>
<p>Hoạt động ở layer-7(Application) - HTTP</p>
</li>
<li>
<p>Hỗ trợ redirect(vd như từ HTTP sang HTTPS)</p>
</li>
<li>
<p>Routing</p>
<ul>
<li>Dựa theo path trên URL</li>
<li>Dựa theo hostname trên URL</li>
<li>Dựa vào query string, hearders</li>
</ul>
</li>
<li>
<p>ALB phù hợp với micro services và app chạy trên container(Docker || Amazon ECS)</p>
</li>
<li>
<p>Có tính năng ánh xạ cổng để điều hướng đến một cổng động trong ECS.</p>
</li>
<li>
<p>Target groups:</p>
<ul>
<li>EC2 Instances (có thể được quản lý bằng Auto Scaling Group) - HTTP</li>
<li>ECS tasks (quản lý bởi ECS) - HTTP</li>
<li>Lambda functions - in a future lecture</li>
<li>IP Addresses - phải là private IPs</li>
</ul>
</li>
<li>
<p>Có thể định tuyến đến nhiều target groups</p>
</li>
<li>
<p>Health checks là một target group.
<img src="../../../00-Meta/01-Attachments/Pasted-image-20230305212402.png" width="auto" height="auto"/></p>
</li>
<li>
<p>Edit inbound rules Security Group của EC2 Instances để client phải truy cập qua ALB chứ không được truy cập trực tiếp qua publicIP của instance.
<img src="../../../00-Meta/01-Attachments/Screenshot-2023-03-06-at-09.14.22.png" width="auto" height="auto"/>được truy cập trực tiếp từ public IP của Instance.</p>
</li>
</ul>
<h3 id="-network-load-balancer">🍃 Network Load Balancer<a aria-hidden="true" tabindex="-1" href="#-network-load-balancer" class="internal"> §</a></h3>
<ul>
<li>v2 - 2017 - NLB</li>
<li>Hoạt động ở layer-4(Transport)
<ul>
<li>Chuyển tiếp TCP &amp; UDP traffic tới các instances.</li>
<li>Mỗi giaay xử lý được hàng triệu requests.</li>
<li>Độ trễ thấp hơn so với ALB (~100ms vs 400ms)</li>
</ul>
</li>
<li>Có một static IP cho từng AZ, có thể sử dụng ElasticIP(hữu ích nếu dự án cần chỉ định IP)</li>
<li>Không được hỗ trợ trong free tier.</li>
<li>Target groups:
<ul>
<li>EC2 Instances</li>
<li>IP Addresses - must be private IPs</li>
<li>Application Load Balancer</li>
</ul>
</li>
<li>Health check hỗ trợ qua các giao thức TCP, HTTP, HTTPS.</li>
</ul>
<h3 id="-gateway-load-balancer">🍃 Gateway Load Balancer<a aria-hidden="true" tabindex="-1" href="#-gateway-load-balancer" class="internal"> §</a></h3>
<ul>
<li>v3 - 2020 - GWLB</li>
<li>Hoạt động ở <a href="../../../50-til/51-Code/06-Servers/Layer-3---Network-Layer" class="internal">layer 3(Network layer)</a> - IP Protocol</li>
<li>Để triển khai, scale và quản lý một cụm network virtual applicances trong AWS, vd như Firewalls, Intrusion Detection and Prevention Systems, …</li>
<li>Kết hợp của:
<ul>
<li><strong>Transparent Network Gateway</strong> - single entry/exit cho tất cả traffic</li>
<li><strong>Load Balencer</strong> -  phân phối traffic tới các virtual appliances.</li>
</ul>
</li>
<li>Sử dụng GENEVE protocol trên cổng 6081</li>
</ul>
<blockquote class="callout" data-callout="note">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="2" x2="22" y2="6"></line><path d="M7.5 20.5 19 9l-4-4L3.5 16.5 2 22z"></path></svg></div>
                  <div class="callout-title-inner"><p>Note </p></div>
                  
                </div>
<p>Khác với ALB và NLB, GWLB mục đích phân tải cho cụm ứng dụng ảo thực hiện các công việc ngăn ngừa các traffic độc hại vd như Firewall</p>
</blockquote>
<h2 id="-security-group">🌿 Security Group<a aria-hidden="true" tabindex="-1" href="#-security-group" class="internal"> §</a></h2>
<p><img src="../../../00-Meta/01-Attachments/Pasted-image-20230305204858.png" width="auto" height="auto"/></p>
<h2 id="-sticky-sessionsession-affinity">🌿 Sticky Session(Session Affinity)<a aria-hidden="true" tabindex="-1" href="#-sticky-sessionsession-affinity" class="internal"> §</a></h2>
<ul>
<li>Là tính năng điều hướng requests của cùng một người dùng đến cùng một instance. Đảm bảo tính nhất quán trong phiên làm việc cùa người dùng và tránh phân tán dữ liệu trên nhiều instances.</li>
<li>Tính năng hoạt động trên CLB &amp; ALB</li>
<li>Gửi Cookie tới client, với mỗi request sau sẽ được gắn cookie để xác định phiên của người dùng, ELB sẽ thực hiện điều hướng tới cùng một instance. Khi cookie hết hạn, người dùng có thể được điều hướng qua một instance khác.</li>
<li>Use case: trong TH chúng ta không muốn thất lạc dữ liệu trong phiên hoạt động của người dùng.</li>
<li>Tuy nhiên, tính năng này cũng có khả năng gây nên mất cân bằng tải do nhiều user sticky trên một instance chẳng hạn.</li>
<li>Cookie name:
<ul>
<li><strong>Application-based Cookies</strong>
<ul>
<li>Custom cookie</li>
<li>Application cookie</li>
</ul>
</li>
<li><strong>Duration-based Cookies</strong></li>
</ul>
</li>
</ul>
<h2 id="-cross-zone-load-balancing">🌿 Cross-Zone Load Balancing<a aria-hidden="true" tabindex="-1" href="#-cross-zone-load-balancing" class="internal"> §</a></h2>
<ul>
<li>Cân bằng tải cho tất cả các instances ở trên nhiều AZs.
<img src="../../../00-Meta/01-Attachments/Screenshot-2023-03-06-at-17.40.10.png" width="auto" height="auto"/></li>
<li>ALB
<ul>
<li>Mặc định được bật(có thể tắt ở phần edit attributes của target group)</li>
<li>Không phải trả phí</li>
</ul>
</li>
<li>NLB &amp; GWLB
<ul>
<li>Mặc định tắt</li>
<li>Bật lên thì phải trả tiền</li>
</ul>
</li>
<li>CLB
<ul>
<li>Mặc định tắt</li>
<li>Không phải trả nếu bật</li>
</ul>
</li>
</ul>
<h2 id="-ssl-certificates">🌿 SSL Certificates<a aria-hidden="true" tabindex="-1" href="#-ssl-certificates" class="internal"> §</a></h2>
<p><img src="../../../00-Meta/01-Attachments/Pasted-image-20230306221530.png" width="auto" height="auto"/></p>
<ul>
<li>Sử dụng X.509 certificate(SSL/TLS server certificate)</li>
<li>Có thể quản lý các certificates bằng ACM - Amazon Certificate Manager</li>
<li>Có thể tự tạo certificates.</li>
<li>HTTP listener:
<ul>
<li>Bạn cần có một default certificate</li>
<li>Bạn có thể thêm một danh sách các certs để hỗ trợ cho multiple domains</li>
<li><strong>Clients có thể sử dụng SNI - Server Name Indication để chỉ định hostname</strong></li>
<li>Có khả năng chỉ dịnh một chính sách bảo mật để hỗ trợ cho những phiên bản cũ SSL/TLS.</li>
</ul>
</li>
</ul>
<h3 id="-server-name-indication">🍃 Server Name Indication<a aria-hidden="true" tabindex="-1" href="#-server-name-indication" class="internal"> §</a></h3>
<ul>
<li>Giải quyết vấn đề phải load nhiều chứng chỉ SSL trên cùng một web server.</li>
<li>Giao thức mới, yêu cầu người dùng phải chỉ định hostname của tên máy chủ target trong lần đầu thực hiện khởi tạo SSL handshake.</li>
<li>Server sẽ tìm ra đúng chứng chỉ hoặc trả về mặc định.</li>
<li>Chỉ work với ALB &amp; NLB, CloudFront</li>
</ul>
<h2 id="-connection-draining">🌿 Connection Draining<a aria-hidden="true" tabindex="-1" href="#-connection-draining" class="internal"> §</a></h2>
<ul>
<li><strong>Feature naming</strong>:
<ul>
<li>Connection Draining - for CLB</li>
<li>Deregistration Delay - for ALB &amp; NLB</li>
</ul>
</li>
<li>Là tính năng giúp cho ELB dừng gửi traffic tới một instance đang có vấn đề(unhealthy, deploy lại) nhưng vẫn giữ kết nối tới instance đó.</li>
<li>Có thể tắt tính năng này đi</li>
</ul></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xmlSpace="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li><a href="../../../40123345-posts/42-Code/42.03-AWS/EC2---Elastic-Compute-Cloud" class="internal">🌱 EC2 - Elastic Compute Cloud</a></li></ul></div></div></div><footer><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.0.10</a>, © 2023</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">
          const socket = new WebSocket('ws://localhost:3001')
          socket.addEventListener('message', () => document.location.reload())
        </script><script src="../../../postscript.js" type="module"></script></html>