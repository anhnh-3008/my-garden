---
title: "ğŸŒ± S3"
tags: [aws]
date: 2023-03-13
---

## ğŸŒ¿ Introduction
- S3 lÃ  má»™t trong nhá»¯ng khá»‘i xÃ¢y dá»±ng chÃ­nh cá»§a AWS
- NÃ³ Ä‘Æ°á»£c quáº£ng cÃ¡o lÃ  cÃ³ kháº£ nÄƒng lÆ°u trá»¯ vÃ´ háº¡n
- Nhiá»u Web sá»­ dá»¥ng S3 nhÆ° Backbone
- Nhiá»u services cá»§a AWS sá»­ dá»¥ng S3 Ä‘á»ƒ integrate tá»‘t hÆ¡n.

## ğŸŒ¿ Buckets
- Cho phÃ©p ngÆ°á»i dÃ¹ng lÆ°u trá»¯ **objects**(files) trong "buckets"(directories)
- Má»™t Bucket sáº½ cÃ³ má»™t tÃªn unique( trÃªn táº¥t cáº£ regions cá»§a táº¥t cáº£ accounts)
- Region level - S3 nhÃ¬n giá»‘ng nhÆ° má»™t global service nhÆ°ng cÃ¡c buckets Ä‘Æ°á»£c táº¡o trÃªn má»™t region.
- Naming convention:
	- KhÃ´ng viáº¿t hoa, khÃ´ng gáº¡ch dÆ°á»›i
	- 3 - 63 kÃ½ tá»±
	- KhÃ´ng pháº£i lÃ  má»™t IP
	- Pháº£i báº¯t Ä‘áº§u báº±ng má»™t chá»¯ cÃ¡i thÆ°á»ng hoáº·c má»™t kÃ½ tá»± sá»‘.
	- KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t prefix lÃ  **xn...**
	- KhÃ´ng Ä‘Æ°á»£c Ä‘áº·t suffix lÃ  **...s3alias**

## ğŸŒ¿ Objects
- Objects(file) cÃ³ má»™t má»™t Key
- Key == full path:
	- s3://my-bucket/my_file.txt
	- s3://my-bucket/another_folder/my_file.txt
- KhÃ´ng cÃ³ khÃ¡i niá»‡m **directories** trong s3, táº¥t cáº£ lÃ  key háº¿t.
- Object value:
	- Max size lÃ  5 TB(5000 Gb)
	- Náº¿u upload file nhiá»u hÆ¡n 5T, pháº£i sá»­ dá»¥ng **multi-part upload**
- CÃ³ metadata
- Tags - há»¯u dá»¥ng cho báº£o máº­t vÃ o vÃ²ng Ä‘á»i.
- Version ID(chá»‰ cÃ³ khi báº­t versioning)

## ğŸŒ¿ Security
- **User-Based**
	- **IAM Policies**
- **Resource-Based**
	- **Bucket Policies** - Ã¡p dá»¥ng cho nhiá»u accounts
	- **Object Access Control List - ACL**
	- **Bucket Access Control List - ACL**
- **Note:** Má»™t IAM principle cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c vÃ o má»™t S3 object pháº£i thá»a mÃ£n:
	- IAM permission cho phÃ©p **OR** resource policy cho phÃ©p
	- **AND** khÃ´ng cÃ³ DENY
- **Encryption:** mÃ£ hÃ³a objects trong S3 sá»­ dá»¥ng encryption keys.

## ğŸŒ¿ S3 Bucket Policies
![[00 Meta/01 Attachments/Pasted image 20230313211733.png]]

- JSON policy chá»©a:
	- Resource: resource chá»‰ Ä‘á»‹nh Ä‘á»ƒ phÃ¢n quyá»n(bucket or objects)
	- Action: lÃ  APIs thao tÃ¡c vá»›i resource
	- Effect: Allow/Deny
	- Principal: chá»‰ Ä‘á»‹nh account/user cho policy
- VÃ­ dá»¥ nhÆ° policy trÃªn lÃ : cho phÃ©p toÃ n bá»™ ngÆ°á»i dÃ¹ng quyá»n get toÃ n bá»™ Objects trong bucket.

## ğŸŒ¿ Bucket settings for Block Public Access
- Nhá»¯ng settings nÃ y Ä‘á»ƒ trÃ¡nh company leak dá»¯ liá»‡u.
- CÃ³ thá»ƒ set á»Ÿ account level
- Náº¿u cháº¯c cháº¯n cÃ¡c respurces sáº½ khÃ´ng Ä‘Æ°á»£c public, chÃºng ta cÃ³ thá»ƒ giá»¯ nguyÃªn cÃ¡c thÃ´ng sá»‘ nÃ y.

## ğŸŒ¿ Static Website Hosting
- S3 cÃ³ thá»ƒ host má»™t static website vÃ  giÃºp chÃºng cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c trÃªn InternetmÃ  khÃ´ng cáº§n sá»­ dá»¥ng mÃ¡y chá»§ web riÃªng.
- URL cÃ³ dáº¡ng:
	- http://bucket-name.s3-website-aws-region.amazonaws.com
	- hoáº·c http://bucket-name.s3-website.aws-region.amazonaws.com
- Náº¿u mÃ£ tráº£ vá» 403, hÃ£y cháº¯c ráº±ng báº¡n Ä‘Ã£ setup policy Ä‘á»ƒ cho phÃ©p viá»‡c truy cáº­p public.
- Æ¯u Ä‘iá»ƒm:
	- Chi phÃ­ tháº¥p
	- TÃ­nh sáºµn sÃ ng cao
	- Kháº£ nÄƒng má»Ÿ rá»™ng vÃ´ háº¡n
- NhÆ°á»£c Ä‘iá»ƒm:
	- Giá»›i háº¡n kháº£ nÄƒng phÃ¡t triá»ƒn tÃ­nh nÄƒng, vÃ­ dá»¥ nhÆ° cháº¡y script, khÃ´ng dÃ¹ng cho web Ä‘á»™ng,...

## ğŸŒ¿ Versioning
- Báº¡n cÃ³ thá»ƒ Ä‘Ã¡nh phiÃªn báº£n cho cÃ¡c files trÃªn Amazon S3
- NÃ³ Ä‘Æ°á»£c báº­t á»Ÿ **bucket level**
- CÃ¹ng má»™t key, náº¿u overwrite thÃ¬ phiÃªn báº£n sáº½ Ä‘Æ°á»£c update.
- Best practice Ä‘á»ƒ quáº£n lÃ½ version cho bucket:
	- Báº£o vá»‡ tá»«ng phiÃªn báº£n má»™t -> dá»… Ä‘ang restore vá» má»™t version trÆ°á»›c Ä‘Ã³
- Notes:
	- CÃ¡c files Ä‘Ã£ tá»“n táº¡i trÆ°á»›c khi báº­t tÃ­nh nÄƒng **versioning** sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh version = null.
	- Táº¡m dá»«ng tÃ­nh nÄƒng **versioning** sáº½ khÃ´ng bá»‹ xÃ³a cÃ¡c phiÃªn báº£n trÆ°á»›c Ä‘Ã³.

## ğŸŒ¿ Replication
- **Pháº£i báº­t Versioning** cho cáº£ 2 Buckets á»Ÿ 2 regions.
- **Cross-Region Replication (CRR)**
- **Same-Region Replication (SRR)**
- CÃ¡c buckets cÃ³ thá»ƒ thuá»™c vá» nhá»¯ng accounts khÃ¡c nhau, khÃ´ng nháº¥t thiáº¿t lÃ  pháº£i chung account thÃ¬ má»›i thá»±c hiá»‡n replication Ä‘Æ°á»£c.
- QuÃ¡ trÃ¬nh copying giá»¯a 2 buckets lÃ  báº¥t Ä‘á»“ng bá»™
- Pháº£i cung cáº¥p IAM permissions phÃ¹ há»£p cho S3.
- Use Cases:
	- **CRR** - dÃ¹ng khi cáº§n truy cáº­p tá»« nhiá»u region vá»›i Ä‘á»™ trá»… tháº¥p.
	- **SSR** - tá»•ng há»£p Ä‘Æ°á»£c log, live replication giá»¯a cÃ¡c accounts production vÃ  test.
- **Notes:**
	- Sau khi báº­t tÃ­nh nÄƒng **replication**, chá»‰ nhá»¯ng objects má»›i vá» sau má»›i cÃ³ báº£n sao.
	- Náº¿u muá»‘n táº¡o báº£n sao cho nhá»¯ng objects Ä‘Ã£ tá»“n táº¡i, sá»­ dá»¥ng tÃ­nh nÄƒng **S3 Batch Replication**
		- TÃ­nh nÄƒng nÃ y sáº½ táº¡o báº£n sao cho nhá»¯ng objects Ä‘Ã£ tá»“n táº¡i ngoÃ i ra cÃ²n táº¡o cho nhá»¯ng objects Ä‘Ã£ tháº¥t báº¡i khi táº¡o báº£n sao á»Ÿ nhá»¯ng láº§n trÆ°á»›c Ä‘Ã³.
	- Vá» cÆ¡ cháº¿ DELETE:
		- **CÃ³ thá»ƒ táº¡o báº£n sao cho object xÃ³a markers(xÃ³a theo version)** tá»« bucket source sang bucket target(optional setting)
		- XÃ³a vá»›i má»™t version ID(xÃ³a vÄ©nh viá»…n) sáº½ khÃ´ng Ä‘Æ°á»£c táº¡o báº£n sao.
	- **KhÃ´ng há»— trá»£ sao chÃ©p chuá»—i**
		- Tá»©c lÃ  cÃ³ 3 bucket1,2,3. Náº¿u muá»‘n sao chÃ©p bucket1 Ä‘áº¿n 2 vÃ  3 thÃ¬ sao chÃ©p trá»±c tiáº¿p 1 -> 2 vÃ  1 -> 3. Chá»© khÃ´ng Ä‘Æ°á»£c 1 -> 2 -> 3.

## ğŸŒ¿ TÃ­nh bá»n bá»‰(durability) vÃ  tÃ­nh kháº£ dá»¥ng(availability)
- Durability:
	- Ráº¥t bá»n bá»‰, á»©ng vá»›i táº¥t cáº£ cÃ¡c objects trÃªn táº¥t cáº£ cÃ¡c regions.
	- Náº¿u báº¡n lÆ°u trá»¯ 10,000 objects trÃªn Amazon S3, trung bÃ¬nh 10,000 nÄƒm chÃºng ta sáº½ bá»‹ máº¥t má»™t object.
	- Äiá»u nÃ y Ä‘Ãºng vá»›i táº¥t cáº£ cÃ¡c storage class.
- Availability:
	- LuÃ´n kháº£ dá»¥ng khi cáº§n truy cáº­p.
	- CÃ³ sá»± khÃ¡c nhau giá»¯a cÃ¡c class.
	- VÃ­ dá»¥ S3 tiÃªu chuáº©n cÃ³ 99,99% kháº£ dá»¥ng. Tá»©c lÃ  má»™t nÄƒm thÃ¬ nÃ³ chá»‰ cÃ³ khoáº£ng 53 phÃºt khÃ´ng kháº£ dá»¥ng thÃ´i.

## ğŸŒ¿ Storage Class

### ğŸƒ S3 Standard - General Purpose
- 99,99% kháº£ dá»¥ng
- Sá»­ dá»¥ng cho nhá»¯ng dá»¯ liá»‡u thÆ°á»ng xuyÃªn Ä‘Æ°á»£c truy cáº­p
- Äá»™ trá»… tháº¥p, thÃ´ng lÆ°á»£ng cao.
- CÃ³ thá»ƒ Ä‘á»“ng thá»i duy trÃ¬ 2 facility failures.
- Use cases: PhÃ¢n tÃ­ch BigData, mobile&gaming applications, content distribution, ...

### ğŸƒ S3 Storage Classes - Infrequent Access
- Cho dá»¯ liá»‡u khÃ´ng thÆ°á»ng xuyÃªn Ä‘Æ°á»£c truy cáº­p nhÆ°ng cÃ³ thá»ƒ yÃªu cáº§u truy cáº­p nhanh khi cáº§n.
- GiÃ¡ tháº¥p hÆ¡n S3 Standard
- **Amazon S3 Standard-Infrequent Access (S3 Standard-IA)**
	- 99,9% kháº£ dá»¥ng.
	- Use case: Disaster Recovery, backups
- **Amazon S3 One Zone-Infrequent Access (S3 One Zone-IA**
	- Äá»™ bá»n(99,999999999%) trong má»™t AZ, dá»¯ liá»‡u sáº½ bá»‹ máº¥t khi AZ bá»‹ phÃ¡ há»§y.
	- 99,5% kháº£ dá»¥ng
	- Use case: LÆ°u backups cho dá»¯ liá»‡u Ä‘ang sá»­ dá»¥ng hoáº·c dá»¯ liá»‡u muá»‘n recreate.

### ğŸƒ S3 Glacier Storage Classes
- Chi phÃ­ tháº¥p, lÃ  lá»±a chá»n khi chÃºng ta muá»‘n lÆ°u trá»¯ dá»¯ liá»‡u lÃ¢u dÃ i nhÆ°ng Ã­t Ä‘Æ°á»£c truy cáº­p.
- GiÃ¡  = GiÃ¡ dung lÆ°á»£ng + giÃ¡ truy xuáº¥t object

- **S3 Glacier Instant Retrieval**
	- PhÃ¹ há»£p vá»›i nhu cáº§u truy cáº­p dá»¯ liá»‡u má»™t quÃ½ má»™t láº§n.
	- Tá»‘i thiá»ƒu lÆ°u trá»¯ 90 ngÃ y
- **S3 Glacier Flexible Retrieval**
	- Expected(1-5 phÃºt), Standard(3-5 giá»), Bulk(5-12 giá») - miá»…n phÃ­
	- Tá»‘i thiá»ƒu lÆ°u trá»¯ 90 ngÃ y
- **S3 Glacier Deep Archive** - lÆ°u trá»¯ dÃ i háº¡n
	- Standard(12 giá»), Bulk(48 giá»)
	- Tá»‘i thiá»ƒu lÆ°u trá»¯ trong 180 ngÃ y

### ğŸƒ S3 Intelligent-Tiering
- GiÃºp chuyá»ƒn Ä‘á»•i tá»± Ä‘á»™ng cÃ¡c class dá»±a theo viá»‡c truy xuáº¥t dá»¯ liá»‡u cá»§a ngÆ°á»i dÃ¹ng, tá»« Ä‘Ã³ tá»‘i Æ°u Ä‘Æ°á»£c chi phÃ­ cÅ©ng nhÆ° kháº£ nÄƒng lÆ°u trá»¯ vÃ  truy xuáº¥t dá»¯ liá»‡u phÃ¹ há»£p vá»›i nhu cáº§u sá»­ dá»¥ng cá»§a ngÆ°á»i dÃ¹ng.
- KhÃ´ng pháº£i tráº£ phÃ­ truy xuáº¥t dá»¯ liá»‡u khi lá»±a chá»n option nÃ y.
![[00 Meta/01 Attachments/Pasted image 20230314215836.png]]

### ğŸƒ Comparision
![[00 Meta/01 Attachments/Pasted image 20230314220020.png]]