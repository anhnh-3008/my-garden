<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="🌿 What? ![[00 Meta/01 Attachments/Pasted image 20230305184858.png]]
Là dịch vụ phân phối tải tới các instances của hệ thống. 🌿 Why to use?"><title>🥦 ELB - Elastic Load Balancing</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://anhhn.netlify.app//icon.png><link href=https://anhhn.netlify.app/styles.fffdfa86ac55060b53797e4fb7b830fd.min.css rel=stylesheet><link href=https://anhhn.netlify.app/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://anhhn.netlify.app/js/darkmode.183fcede5b91e00cd4379bf6fc1fe35f.min.js></script>
<script src=https://anhhn.netlify.app/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://anhhn.netlify.app/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://anhhn.netlify.app/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://anhhn.netlify.app/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://anhhn.netlify.app/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://anhhn.netlify.app/",fetchData=Promise.all([fetch("https://anhhn.netlify.app/indices/linkIndex.4c8f71f40721a7093aafd0f5e37ddd03.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://anhhn.netlify.app/indices/contentIndex.049e4af6fe8a101e11796984a9339ecf.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://anhhn.netlify.app",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://anhhn.netlify.app",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{"’":"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/anhhn.netlify.app\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HDBMVFQGBH"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HDBMVFQGBH",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://anhhn.netlify.app/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><h1 id=page-title><a href=https://anhhn.netlify.app/>Home</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>🥦 ELB - Elastic Load Balancing</h1><p class=meta>Last updated
Mar 5, 2023
<a href=https://github.com/anhnh-3008/quartz/tree/hugo/content/40123345%20posts/42%20Code/42.03%20AWS/ELB%20-%20Elastic%20Load%20Balancing.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://anhhn.netlify.app/tags/aws/>Aws</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#-what>🌿 What?</a></li><li><a href=#-why-to-use>🌿 Why to use?</a></li><li><a href=#-types-of-load-balancer-on-aws>🌿 Types of load balancer on AWS</a><ol><li><a href=#-classic-load-balancer>🍃 Classic Load Balancer</a></li><li><a href=#-application-load-balancer>🍃 Application Load Balancer</a></li><li><a href=#-network-load-balancer>🍃 Network Load Balancer</a></li><li><a href=#-gateway-load-balancer>🍃 Gateway Load Balancer</a></li></ol></li><li><a href=#-security-group>🌿 Security Group</a></li><li><a href=#-sticky-sessionsession-affinity>🌿 Sticky Session(Session Affinity)</a></li><li><a href=#-cross-zone-load-balancing>🌿 Cross-Zone Load Balancing</a></li><li><a href=#-ssl-certificates>🌿 SSL Certificates</a><ol><li><a href=#-server-name-indication>🍃 Server Name Indication</a></li></ol></li><li><a href=#-connection-draining>🌿 Connection Draining</a></li></ol></nav></details></aside><a href=#-what><h2 id=-what><span class=hanchor arialabel=Anchor># </span>🌿 What?</h2></a><p><img src="/00 Meta/01 Attachments/Pasted image 20230305184858.png" width=auto class=myImg></p><ul><li>Là dịch vụ phân phối tải tới các instances của hệ thống.</li></ul><a href=#-why-to-use><h2 id=-why-to-use><span class=hanchor arialabel=Anchor># </span>🌿 Why to use?</h2></a><ul><li>Phân phối tải đều cho những instances của hệ thống, tránh tình trạng quá tải.</li><li>Expose một điểm truy cập(DNS) duy nhất cho ứng dụng</li><li>Vẫn hoạt động bình thường khi có lỗi ở một instance.</li><li>Cung cấp SSL cho web</li><li>Tách biệt được public traffic và private traffic.</li><li>Thực hiện heath check thường xuyên cho các instances.</li></ul><a href=#-types-of-load-balancer-on-aws><h2 id=-types-of-load-balancer-on-aws><span class=hanchor arialabel=Anchor># </span>🌿 Types of load balancer on AWS</h2></a><ul><li>Nên dùng mấy cái gen mới, nó sẽ cung cấp nhiều tính năng mới hơn.</li><li>Một số load balancers có thể setup private hoặc public ELBs.</li></ul><a href=#-classic-load-balancer><h3 id=-classic-load-balancer><span class=hanchor arialabel=Anchor># </span>🍃 Classic Load Balancer</h3></a><ul><li>v1 - 2009 - CLB (có warning deprecated nhưng vẫn available)</li><li>HTTP, HTTPS, TCP, SSL</li></ul><a href=#-application-load-balancer><h3 id=-application-load-balancer><span class=hanchor arialabel=Anchor># </span>🍃 Application Load Balancer</h3></a><ul><li><p>v2 - 2016 - ALB</p></li><li><p>Hoạt động ở layer-7(Application) - HTTP</p></li><li><p>Hỗ trợ redirect(vd như từ HTTP sang HTTPS)</p></li><li><p>Routing</p><ul><li>Dựa theo path trên URL</li><li>Dựa theo hostname trên URL</li><li>Dựa vào query string, hearders</li></ul></li><li><p>ALB phù hợp với micro services và app chạy trên container(Docker || Amazon ECS)</p></li><li><p>Có tính năng ánh xạ cổng để điều hướng đến một cổng động trong ECS.</p></li><li><p>Target groups:</p><ul><li>EC2 Instances (có thể được quản lý bằng Auto Scaling Group) - HTTP</li><li>ECS tasks (quản lý bởi ECS) - HTTP</li><li>Lambda functions - in a future lecture</li><li>IP Addresses - phải là private IPs</li></ul></li><li><p>Có thể định tuyến đến nhiều target groups</p></li><li><p>Health checks là một target group.
<img src="/00 Meta/01 Attachments/Pasted image 20230305212402.png" width=auto class=myImg></p></li><li><p>Edit inbound rules Security Group của EC2 Instances để client phải truy cập qua ALB chứ không được truy cập trực tiếp qua publicIP của instance.
<img src="/00 Meta/01 Attachments/Screenshot 2023-03-06 at 09.14.22.png" width=auto class=myImg>được truy cập trực tiếp từ public IP của Instance.</p></li></ul><a href=#-network-load-balancer><h3 id=-network-load-balancer><span class=hanchor arialabel=Anchor># </span>🍃 Network Load Balancer</h3></a><ul><li>v2 - 2017 - NLB</li><li>Hoạt động ở layer-4(Transport)<ul><li>Chuyển tiếp TCP & UDP traffic tới các instances.</li><li>Mỗi giaay xử lý được hàng triệu requests.</li><li>Độ trễ thấp hơn so với ALB (~100ms vs 400ms)</li></ul></li><li>Có một static IP cho từng AZ, có thể sử dụng ElasticIP(hữu ích nếu dự án cần chỉ định IP)</li><li>Không được hỗ trợ trong free tier.</li><li>Target groups:<ul><li>EC2 Instances</li><li>IP Addresses - must be private IPs</li><li>Application Load Balancer</li></ul></li><li>Health check hỗ trợ qua các giao thức TCP, HTTP, HTTPS.</li></ul><a href=#-gateway-load-balancer><h3 id=-gateway-load-balancer><span class=hanchor arialabel=Anchor># </span>🍃 Gateway Load Balancer</h3></a><ul><li>v3 - 2020 - GWLB</li><li>Hoạt động ở <a href=/50-til/51-Code/51.06-Servers/Layer-3-Network-Layer rel=noopener class=internal-link data-src=/50-til/51-Code/51.06-Servers/Layer-3-Network-Layer>layer 3(Network layer)</a> - IP Protocol</li><li>Để triển khai, scale và quản lý một cụm network virtual applicances trong AWS, vd như Firewalls, Intrusion Detection and Prevention Systems, &mldr;</li><li>Kết hợp của:<ul><li><strong>Transparent Network Gateway</strong> - single entry/exit cho tất cả traffic</li><li><strong>Load Balencer</strong> - phân phối traffic tới các virtual appliances.</li></ul></li><li>Sử dụng GENEVE protocol trên cổng 6081</li></ul><blockquote class=note-callout><p>Note</p><p>Khác với ALB và NLB, GWLB mục đích phân tải cho cụm ứng dụng ảo thực hiện các công việc ngăn ngừa các traffic độc hại vd như Firewall</p></blockquote><a href=#-security-group><h2 id=-security-group><span class=hanchor arialabel=Anchor># </span>🌿 Security Group</h2></a><p><img src="/00 Meta/01 Attachments/Pasted image 20230305204858.png" width=auto class=myImg></p><a href=#-sticky-sessionsession-affinity><h2 id=-sticky-sessionsession-affinity><span class=hanchor arialabel=Anchor># </span>🌿 Sticky Session(Session Affinity)</h2></a><ul><li>Là tính năng điều hướng requests của cùng một người dùng đến cùng một instance. Đảm bảo tính nhất quán trong phiên làm việc cùa người dùng và tránh phân tán dữ liệu trên nhiều instances.</li><li>Tính năng hoạt động trên CLB & ALB</li><li>Gửi Cookie tới client, với mỗi request sau sẽ được gắn cookie để xác định phiên của người dùng, ELB sẽ thực hiện điều hướng tới cùng một instance. Khi cookie hết hạn, người dùng có thể được điều hướng qua một instance khác.</li><li>Use case: trong TH chúng ta không muốn thất lạc dữ liệu trong phiên hoạt động của người dùng.</li><li>Tuy nhiên, tính năng này cũng có khả năng gây nên mất cân bằng tải do nhiều user sticky trên một instance chẳng hạn.</li><li>Cookie name:<ul><li><strong>Application-based Cookies</strong><ul><li>Custom cookie</li><li>Application cookie</li></ul></li><li><strong>Duration-based Cookies</strong></li></ul></li></ul><a href=#-cross-zone-load-balancing><h2 id=-cross-zone-load-balancing><span class=hanchor arialabel=Anchor># </span>🌿 Cross-Zone Load Balancing</h2></a><ul><li>Cân bằng tải cho tất cả các instances ở trên nhiều AZs.
<img src="/00 Meta/01 Attachments/Screenshot 2023-03-06 at 17.40.10.png" width=auto class=myImg></li><li>ALB<ul><li>Mặc định được bật(có thể tắt ở phần edit attributes của target group)</li><li>Không phải trả phí</li></ul></li><li>NLB & GWLB<ul><li>Mặc định tắt</li><li>Bật lên thì phải trả tiền</li></ul></li><li>CLB<ul><li>Mặc định tắt</li><li>Không phải trả nếu bật</li></ul></li></ul><a href=#-ssl-certificates><h2 id=-ssl-certificates><span class=hanchor arialabel=Anchor># </span>🌿 SSL Certificates</h2></a><p><img src="/00 Meta/01 Attachments/Pasted image 20230306221530.png" width=auto class=myImg></p><ul><li>Sử dụng X.509 certificate(SSL/TLS server certificate)</li><li>Có thể quản lý các certificates bằng ACM - Amazon Certificate Manager</li><li>Có thể tự tạo certificates.</li><li>HTTP listener:<ul><li>Bạn cần có một default certificate</li><li>Bạn có thể thêm một danh sách các certs để hỗ trợ cho multiple domains</li><li><strong>Clients có thể sử dụng SNI - Server Name Indication để chỉ định hostname</strong></li><li>Có khả năng chỉ dịnh một chính sách bảo mật để hỗ trợ cho những phiên bản cũ SSL/TLS.</li></ul></li></ul><a href=#-server-name-indication><h3 id=-server-name-indication><span class=hanchor arialabel=Anchor># </span>🍃 Server Name Indication</h3></a><ul><li>Giải quyết vấn đề phải load nhiều chứng chỉ SSL trên cùng một web server.</li><li>Giao thức mới, yêu cầu người dùng phải chỉ định hostname của tên máy chủ target trong lần đầu thực hiện khởi tạo SSL handshake.</li><li>Server sẽ tìm ra đúng chứng chỉ hoặc trả về mặc định.</li><li>Chỉ work với ALB & NLB, CloudFront</li></ul><a href=#-connection-draining><h2 id=-connection-draining><span class=hanchor arialabel=Anchor># </span>🌿 Connection Draining</h2></a><ul><li><strong>Feature naming</strong>:<ul><li>Connection Draining - for CLB</li><li>Deregistration Delay - for ALB & NLB</li></ul></li><li>Là tính năng giúp cho ELB dừng gửi traffic tới một instance đang có vấn đề(unhealthy, deploy lại) nhưng vẫn giữ kết nối tới instance đó.</li><li>Có thể tắt tính năng này đi</li></ul><div id=modalShowImage class=modal><span class=close>&#215;</span>
<img class=modal-content id=modal-content-img></div><script>$(".myImg").on("click",function(){$("#modalShowImage").css("display","block"),$("#modal-content-img").attr("src",this.src),$("body").addClass("modal-open")}),$("#modalShowImage").on("hidden.bs.modal",function(){$("body").removeClass("modal-open")}),$("#modalShowImage").on("click",".close",function(){$("#modalShowImage").css("display","none"),$("body").removeClass("modal-open")})</script></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/40123345-posts/42-Code/42.03-AWS/EC2-Elastic-Compute-Cloud/ data-ctx="ELB - Elastic Load Balancing" data-src=/40123345-posts/42-Code/42.03-AWS/EC2-Elastic-Compute-Cloud class=internal-link>🥦 EC2 - Elastic Compute Cloud</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://anhhn.netlify.app/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by anhnh using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://anhhn.netlify.app/>Home</a></li><li><a href="https://www.facebook.com/profile.php?id=100026527598703">Facebook</a></li><li><a href=https://github.com/anhnh-3008>Github</a></li></ul></footer></div></div></body></html>