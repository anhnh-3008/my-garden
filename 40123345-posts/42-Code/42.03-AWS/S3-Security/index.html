<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="🌿 Object Encryption Bạn có thể mã hóa objects trong S3 buckets bằng4 phương thức sau:
Server-Side Encryption (SSE) Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3) - Enabled by Default Mã hóa bằng key được xử lý, quản lý và sở hữu của AWS."><title>🥦 S3 Security</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://anhhn.netlify.app//icon.png><link href=https://anhhn.netlify.app/styles.fffdfa86ac55060b53797e4fb7b830fd.min.css rel=stylesheet><link href=https://anhhn.netlify.app/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://anhhn.netlify.app/js/darkmode.183fcede5b91e00cd4379bf6fc1fe35f.min.js></script>
<script src=https://anhhn.netlify.app/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://anhhn.netlify.app/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://anhhn.netlify.app/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://anhhn.netlify.app/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://anhhn.netlify.app/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://anhhn.netlify.app/",fetchData=Promise.all([fetch("https://anhhn.netlify.app/indices/linkIndex.4c8f71f40721a7093aafd0f5e37ddd03.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://anhhn.netlify.app/indices/contentIndex.0bf7ea9a682b5356d3fcbcba7bfaa600.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://anhhn.netlify.app",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://anhhn.netlify.app",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{"’":"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/anhhn.netlify.app\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-HDBMVFQGBH"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-HDBMVFQGBH",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://anhhn.netlify.app/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script><h1 id=page-title><a href=https://anhhn.netlify.app/>Home</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>🥦 S3 Security</h1><p class=meta>Last updated
Mar 15, 2023
<a href=https://github.com/anhnh-3008/quartz/tree/hugo/content/40123345%20posts/42%20Code/42.03%20AWS/S3%20Security.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://anhhn.netlify.app/tags/aws/>Aws</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#-object-encryption>🌿 Object Encryption</a><ol><li><a href=#-sse---s3>🍃 SSE - S3</a></li><li><a href=#-sse---kms>🍃 SSE - KMS</a></li><li><a href=#-sse---c>🍃 SSE - C</a></li><li><a href=#-client-side-encryption>🍃 Client-Side Encryption</a></li></ol></li><li><a href=#-cors---cross-origin-resource-sharing>🌿 CORS - Cross Origin Resource Sharing</a></li><li><a href=#-mfa-delete>🌿 MFA Delete</a></li><li><a href=#-access-log>🌿 Access Log</a></li><li><a href=#-pre-signed-urls>🌿 Pre-Signed URLs</a></li><li><a href=#-glacier-vault-lock>🌿 Glacier Vault Lock</a></li><li><a href=#-object-lock>🌿 Object Lock</a></li><li><a href=#-access-point>🌿 Access Point</a></li><li><a href=#-s3-object-lambda>🌿 S3 Object Lambda</a></li></ol></nav></details></aside><a href=#-object-encryption><h2 id=-object-encryption><span class=hanchor arialabel=Anchor># </span>🌿 Object Encryption</h2></a><ul><li><p>Bạn có thể mã hóa objects trong S3 buckets bằng4 phương thức sau:</p><ul><li><strong>Server-Side Encryption (SSE)</strong><ul><li><strong>Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3) - Enabled by Default</strong><ul><li>Mã hóa bằng key được xử lý, quản lý và sở hữu của AWS.</li></ul></li><li><strong>Server-Side Encryption with KMS Keys stored in AWS KMS(SSE-KMS)</strong><ul><li>Tận dụng AWS Key Management Service (AWS KMS) để quản lý các keys mã hóa</li></ul></li><li><strong>Server-Side Encryption with Customer-Provided Keys (SSE-C)</strong><ul><li>Khi bạn muốn tự quản lý các keys của mình sở hữu.</li></ul></li></ul></li><li><strong>Client-Side Encryption</strong></li></ul></li><li><p>Cần hiểu để vận dụng cho những tình huống xuất hiện trong bài thi.</p></li><li><p><strong>Notes: Bucket Policies được đánh giá trước(ưu tiên hơn) Default Encryption</strong>
<img src="/00 Meta/01 Attachments/Pasted image 20230315214628.png" width=auto class=myImg></p></li><li><p>Chúng ta có thể chỉ định phương thức mã hóa ở trong <strong>Bucket Policicy</strong></p></li></ul><a href=#-sse---s3><h3 id=-sse---s3><span class=hanchor arialabel=Anchor># </span>🍃 SSE - S3</h3></a><ul><li>Mã hóa sử dụng keys được xử lý, quản lý cũng như sở hữu bởi AWS.</li><li>Object được mã hóa ở Server Side</li><li>Loại mã hóa là <strong>AES-256</strong></li><li>Phải set header là <strong>&ldquo;x-amz-server-side-encryption&rdquo;:&ldquo;AES256&rdquo;</strong></li><li><strong>Mặc định được bật cho những buckets mới hoặc objects mới</strong>
<img src="/00 Meta/01 Attachments/Pasted image 20230315211412.png" width=auto class=myImg></li></ul><a href=#-sse---kms><h3 id=-sse---kms><span class=hanchor arialabel=Anchor># </span>🍃 SSE - KMS</h3></a><ul><li>Mã hóa sử dụng các keys được xử lý và quản lý bởi AWS KMS(Key Management Service)</li><li>Lợi ích: người dùng control + audit key bằng CloudTrail</li><li>Object mã hóa ở server-side</li><li>Phải set header là <strong>&ldquo;x-amz-server-side-encryption&rdquo;:&ldquo;aws:kms&rdquo;</strong></li><li>Ở cách mã hóa này, không chỉ đòi hỏi người dùng có quyền truy cập vào object mà người dùng còn cần phải có key thì mới giải mã để xem được object.</li></ul><p><img src="/00 Meta/01 Attachments/Pasted image 20230315211924.png" width=auto class=myImg></p><ul><li>Giới hạn:<ul><li>Có thể bị ảnh hưởng bởi giới hạn của KMS</li><li>Khi upload, nó sẽ gọi <strong>GenerateDataKey</strong> KMS API</li><li>Khi download, nó sẽ gọi <strong>Decrypt</strong> KMS API</li><li>Tùy từng region, mỗi giây có thể gọi được từ 5000-30000 req/s</li><li>Bạn có thể yêu cầu để tăng số lượng request/s trên Service Quotas Console</li></ul></li></ul><a href=#-sse---c><h3 id=-sse---c><span class=hanchor arialabel=Anchor># </span>🍃 SSE - C</h3></a><ul><li>Sử dụng các keys thuộc toàn quyền sở hữu của khách hàng ngoài AWS.</li><li>S3 không lưu trữ các keys mã hóa này</li><li><strong>Phải sử dụng HTTPS</strong></li><li>Key mã hóa cần phải được cung cấp trong Header, với tất cả các request, áp dụng cho cả việc đọc và ghi dữ liệu.
<img src="/00 Meta/01 Attachments/Pasted image 20230315213039.png" width=auto class=myImg></li></ul><a href=#-client-side-encryption><h3 id=-client-side-encryption><span class=hanchor arialabel=Anchor># </span>🍃 Client-Side Encryption</h3></a><ul><li>Người dùng sử dụng các thư viện như <strong>Amazon S3 Clien-Side Encryption Library</strong> để lưu keys mã hóa.</li><li>Client tự phải mã hóa dữ liệu trước khi gửi lên S3 lưu trữ.</li><li>Client tự phải giải mã dữ liệu khi truy xuất từ S3</li><li>Client toàn quyền quản lý các keys cung như encryption cycle.</li></ul><p><img src="/00 Meta/01 Attachments/Pasted image 20230315213437.png" width=auto class=myImg></p><a href=#-cors---cross-origin-resource-sharing><h2 id=-cors---cross-origin-resource-sharing><span class=hanchor arialabel=Anchor># </span>🌿 CORS - Cross Origin Resource Sharing</h2></a><ul><li>Origin = scheme(protocol) +host(domain) + port</li><li>Dựa theo cơ chế này để quyết định xem có cho phép một origin khác truy cập vào tài nguyên của một origin không.</li><li>Một request sẽ không được hoàn thành trừ khi origin kia cho phép, sử dụng <strong>CORS Hearder(ex: Access-Control-Allow-Origin)</strong></li></ul><a href=#-mfa-delete><h2 id=-mfa-delete><span class=hanchor arialabel=Anchor># </span>🌿 MFA Delete</h2></a><ul><li>Một phương thức giúp ngăn ngừa sai xót khi lựa chọn xoá hoàn toàn(permanent delete), yêu cầu người dùng nhập thêm bảo mật 2 lớp để xác nhận xoá.</li><li>MFA sẽ được yêu cầu khi:<ul><li>Xoá vĩnh viễn một object</li><li>Tắt versioning trên bucket</li></ul></li><li>MFA sẽ không được yêu cầu khi:<ul><li>Bật versioning</li><li>Liệt kê các object đã bị xoá</li></ul></li><li>Để sử dụng MFA Delete, <strong>Phải bật versioning</strong> cho bucket</li><li><strong>Chỉ bucket owner(root account) mới có thể bật/tắt MFA Delete</strong></li></ul><a href=#-access-log><h2 id=-access-log><span class=hanchor arialabel=Anchor># </span>🌿 Access Log</h2></a><ul><li>Tự động lưu lại toàn bộ các requests của tất cả các accounts đến bucket.</li><li>Dùng cho mục đích audit</li><li>Bucket vs bucket set logging phải chung một region
<img src="/00 Meta/01 Attachments/Pasted image 20230316153210.png" width=auto class=myImg></li><li><strong>Warning</strong><ul><li>Không được set logging bucket và bucket tương tác với users là 1, vì nó sẽ dẫn đến tình trạng sinh requests vô hạn đến bucket -> đốt tiền.
<img src="/00 Meta/01 Attachments/Pasted image 20230316155423.png" width=auto class=myImg></li></ul></li></ul><a href=#-pre-signed-urls><h2 id=-pre-signed-urls><span class=hanchor arialabel=Anchor># </span>🌿 Pre-Signed URLs</h2></a><p><img src="/00 Meta/01 Attachments/Screenshot 2023-03-16 at 16.12.24.png" width=auto class=myImg></p><ul><li><p>Tạo ra pre-signed URLs sử dụng <strong>S3 Console, AWS CLI, SDK</strong></p></li><li><p><strong>URL Expiration</strong>:</p><ul><li><strong>S3 Console</strong>: 1 phút - 720 phút(12 giờ)</li><li><strong>AWS CLI</strong>: thiết lập thời gian hết hạn với tham số <em>&ndash;expires-in</em>, đơn vị là giây(mặc định là 3,600s, max là 604800s ~ 168 giờ)</li></ul></li><li><p>User nhận pre-signed URL như sẽ kế thừa permission, trong thời gian quy định, cho phép thực hiện GET/PUT với bucket.</p></li><li><p>Ex: như Insta, cho phép xem ảnh một thời gian nhất định.</p></li></ul><a href=#-glacier-vault-lock><h2 id=-glacier-vault-lock><span class=hanchor arialabel=Anchor># </span>🌿 Glacier Vault Lock</h2></a><ul><li>Đáp ứng cho những object có mô hình WORM(Write Once Read Many). Ý tưởng là object được ghi vào bucket sẽ không được modify hoặc delete, chỉ đọc được thôi.</li></ul><a href=#-object-lock><h2 id=-object-lock><span class=hanchor arialabel=Anchor># </span>🌿 Object Lock</h2></a><ul><li>Cũng dùng cho mô hình WORM</li><li>Chặn việc xoá một version object theo số lần chỉ định(set 2 lần, xoá đến lần thứ 3 mới được)</li><li><strong>Retention mode - Compliance</strong><ul><li>Object version không thể bị overwrite hoặc delete bởi bất kỳ user nào, kể cả root user.</li><li>Retension mode không thể bị thay đổi.</li></ul></li><li><strong>Retention mode - Governance</strong><ul><li>Hầu hết user không thể orverwrite hoặc delete một object version hoặc sửa đổi lock settings của nó.</li><li>Một số users có quyền đặc biệt có thể thay đổi retention hoặc xoá object.</li></ul></li><li><strong>Retention Period</strong><ul><li>Bảo vệ object trong một khoảng thời gian cố định, có thể extend.</li></ul></li><li><strong>Legal Hold</strong><ul><li>Bảo vệ object vô thời hạn, không phụ thuộc vào retention period.</li><li>Có thể tự do thêm hoặc xoá bằng cách sử dụng quyền <em>s3:PutObjectLegalHold</em> của IAM</li></ul></li></ul><a href=#-access-point><h2 id=-access-point><span class=hanchor arialabel=Anchor># </span>🌿 Access Point</h2></a><ul><li>Một bucket sẽ có nhiều folders, <strong>access point</strong> sẽ xác định quyền truy cập của từng user đối với từng folder.
<img src="/00 Meta/01 Attachments/Pasted image 20230316165829.png" width=auto class=myImg></li><li>Mỗi một <strong>Access Point</strong> có:<ul><li>DNS name(Internet Origin hoặc VPC Origin)</li><li>Một access point policy(giống bucket policy)</li></ul></li></ul><p><img src="/00 Meta/01 Attachments/Pasted image 20230316170258.png" width=auto class=myImg></p><a href=#-s3-object-lambda><h2 id=-s3-object-lambda><span class=hanchor arialabel=Anchor># </span>🌿 S3 Object Lambda</h2></a><ul><li>Sử dụng khi cần format lại dữ liệu trước khi trả về cho người dùng.</li><li>Ví dụ như cần sắp xếp lại theo thứ tự nhất định hay convert tử XML -> JSON, &mldr;
<img src="/00 Meta/01 Attachments/Pasted image 20230316171258.png" width=auto class=myImg></li><li>Lambda hiểu đơn giản là service cho phép chạy code mà không cần có server, phù hợp cho những tác vụ kiểu xử lý dữ liệu trước khi trả về cho người dùng như trên hoặc chạy các tác vụ định kỳ kiểu cuối ngày tổng kết xem hôm nay có bao nhiêu objects mới, &mldr;</li></ul><div id=modalShowImage class=modal><span class=close>&#215;</span>
<img class=modal-content id=modal-content-img></div><script>$(".myImg").on("click",function(){$("#modalShowImage").css("display","block"),$("#modal-content-img").attr("src",this.src),$("body").addClass("modal-open")}),$("#modalShowImage").on("hidden.bs.modal",function(){$("body").removeClass("modal-open")}),$("#modalShowImage").on("click",".close",function(){$("#modalShowImage").css("display","none"),$("body").removeClass("modal-open")})</script></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://anhhn.netlify.app/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by anhnh using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2023</p><ul><li><a href=https://anhhn.netlify.app/>Home</a></li><li><a href="https://www.facebook.com/profile.php?id=100026527598703">Facebook</a></li><li><a href=https://github.com/anhnh-3008>Github</a></li></ul></footer></div></div></body></html>